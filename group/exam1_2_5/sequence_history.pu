@startuml
title 貸出履歴の閲覧（基本フロー＋代替）

actor 職員
boundary メニュー画面
boundary 貸出履歴検索画面
boundary 貸出履歴一覧画面
boundary メッセージ表示
control 履歴照会選択処理
control 管理番号入力処理
control 履歴検索処理
control 表示処理
entity 資料_管理番号
entity 貸出履歴

' 前提：職員はログイン済み
note over 職員,メニュー画面
  前提：職員はシステムにログイン済み
end note

== 基本フロー ==
職員 -> メニュー画面: 「貸出履歴の閲覧」を選択
メニュー画面 -> 履歴照会選択処理: 選択イベント
履歴照会選択処理 -> 貸出履歴検索画面: 画面遷移

職員 -> 貸出履歴検索画面: 管理番号を入力
貸出履歴検索画面 -> 管理番号入力処理: 入力値
管理番号入力処理 -> 資料_管理番号: 形式/存在確認
管理番号入力処理 --> 履歴検索処理: OK(管理番号)

履歴検索処理 -> 貸出履歴: 履歴検索(過去の貸出/返却, 現在の貸出状況)
貸出履歴 --> 履歴検索処理: ヒット件数・履歴明細
履歴検索処理 -> 表示処理: 明細データ
表示処理 -> 貸出履歴一覧画面: 一覧表示
職員 <-- 貸出履歴一覧画面: 履歴確認（現借り手の特定等）

== 代替/例外 ==
alt A1: 貸出履歴が存在しない
  履歴検索処理 --> メッセージ表示: 「貸出履歴が存在しません」
  メッセージ表示 -> 貸出履歴検索画面: 再入力促し
else A2: 入力内容が不正（未入力/形式不正/存在しない管理番号）
  管理番号入力処理 --> メッセージ表示: 「入力内容に誤りがあります」
  メッセージ表示 -> 貸出履歴検索画面: 再入力促し
else A3: システムエラーが発生
  履歴検索処理 --> メッセージ表示: 「システムエラーが発生しました」
  メッセージ表示 -> 貸出履歴検索画面: 戻る
end

@enduml
